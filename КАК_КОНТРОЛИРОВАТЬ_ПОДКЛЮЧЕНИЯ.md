# üîç –ö–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞**

---

## üìä –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É:
```bash
ssh root@37.1.212.51
```
–ü–∞—Ä–æ–ª—å: `LEJ6U5chSK`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ø—Ä–æ–∫—Å–∏:
```bash
ss -tn | grep :8080 | wc -l
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- **0-20** = ‚úÖ –û—Ç–ª–∏—á–Ω–æ (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
- **21-50** = ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ (–º–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, –Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ)
- **51+** = ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

---

## üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥)

### 1. –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ø—Ä–æ–∫—Å–∏ (–ø–æ—Ä—Ç 8080):
```bash
ss -tn | grep :8080 | wc -l
```

### 2. –ö—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω (—Ç–æ–ø 10 IP –∞–¥—Ä–µ—Å–æ–≤):
```bash
ss -tn | grep :8080 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -rn | head -10
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —Å —ç—Ç–æ–≥–æ IP
- –í—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞ = IP –∞–¥—Ä–µ—Å

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
  15 123.45.67.89    ‚Üê –≠—Ç–æ—Ç IP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 15 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
   3 81.218.83.97    ‚Üê –≠—Ç–æ—Ç IP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 3 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:
```bash
free -h
```

**–ù–∞ —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- –°—Ç—Ä–æ–∫–∞ "Mem:" ‚Üí –∫–æ–ª–æ–Ω–∫–∞ "used"
- –ï—Å–ª–∏ –±–æ–ª—å—à–µ 80% = ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
- –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 80% = ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:
```bash
top -bn1 | head -5
```

**–ù–∞ —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- –°—Ç—Ä–æ–∫–∞ "%Cpu(s)"
- –ï—Å–ª–∏ –±–æ–ª—å—à–µ 80% = ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
- –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 80% = ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ

### 5. –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã fail2ban:
```bash
fail2ban-client status tinyproxy
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- "Status: Active" = ‚úÖ –ó–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- "Currently banned: X" = –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ IP –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

---

## üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å–∫—Ä–∏–ø—Ç)

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–≥–æ —Å—Ä–∞–∑—É:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
cat > /usr/local/bin/check-proxy-status.sh << 'EOF'
#!/bin/bash
echo "=========================================="
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞"
echo "=========================================="
echo ""
echo "üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø–æ—Ä—Ç—É 8080:"
CONNECTIONS=$(ss -tn | grep :8080 | wc -l)
echo "   –í—Å–µ–≥–æ: $CONNECTIONS"
if [ $CONNECTIONS -lt 20 ]; then
    echo "   ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ (< 20)"
elif [ $CONNECTIONS -lt 50 ]; then
    echo "   ‚ö†Ô∏è  –ú–Ω–æ–≥–æ (20-50)"
else
    echo "   ‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ (> 50)"
fi
echo ""
echo "üåê –¢–æ–ø 5 IP –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º:"
ss -tn | grep :8080 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -rn | head -5
echo ""
echo "üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:"
free -h | grep Mem | awk '{printf "   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: %s / %s (%.0f%%)\n", $3, $2, $3/$2*100}'
echo ""
echo "üõ°Ô∏è  –°—Ç–∞—Ç—É—Å fail2ban:"
fail2ban-client status tinyproxy 2>/dev/null | grep -E "(Status|Currently banned)" || echo "   fail2ban –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
echo ""
echo "=========================================="
EOF

chmod +x /usr/local/bin/check-proxy-status.sh
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
check-proxy-status.sh
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
watch -n 2 'ss -tn | grep :8080 | wc -l'
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã  
**–í—ã—Ö–æ–¥:** –ù–∞–∂–º–∏—Ç–µ `Ctrl+C`

### –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø—Ä–æ–∫—Å–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
tail -f /var/log/tinyproxy/tinyproxy.log
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å—ã  
**–í—ã—Ö–æ–¥:** –ù–∞–∂–º–∏—Ç–µ `Ctrl+C`

---

## üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –∏—Ö —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ:

```bash
cat > /usr/local/bin/monitor-proxy.sh << 'EOF'
#!/bin/bash
CONNECTIONS=$(ss -tn | grep :8080 | wc -l)
if [ $CONNECTIONS -gt 50 ]; then
    echo "$(date): –í–ù–ò–ú–ê–ù–ò–ï! –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: $CONNECTIONS" >> /var/log/proxy-alerts.log
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email –∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
fi
EOF

chmod +x /usr/local/bin/monitor-proxy.sh

# –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:
(crontab -l 2>/dev/null; echo "*/5 * * * * /usr/local/bin/monitor-proxy.sh") | crontab -
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:**
```bash
cat /var/log/proxy-alerts.log
```

---

## üìä –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º?

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ù–æ—Ä–º–∞–ª—å–Ω–æ | –í–Ω–∏–º–∞–Ω–∏–µ | –ü—Ä–æ–±–ª–µ–º–∞ |
|------------|-----------|----------|----------|
| **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 8080** | 0-20 | 21-50 | 51+ |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** | < 60% | 60-80% | > 80% |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU** | < 50% | 50-80% | > 80% |
| **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP** | 0-10 | 11-50 | 51+ |

---

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ?

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω:
```bash
ss -tn | grep :8080 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -rn | head -10
```

### 2. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –Ω–µ–∑–Ω–∞–∫–æ–º—ã–µ IP:
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ fail2ban –∏—Ö –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç
- –ï—Å–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ fail2ban

### 3. –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –±–æ–ª—å—à–µ 50:
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∫—Å–∏ (–∑–∞–∫—Ä–æ–µ—Ç –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
systemctl restart tinyproxy

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É
sleep 60 && ss -tn | grep :8080 | wc -l
```

### 4. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ UFW –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç–∞—é—Ç:
  ```bash
  ufw status | grep 8080
  ```
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ MaxClients —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
  ```bash
  grep MaxClients /etc/tinyproxy/tinyproxy.conf
  ```

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—à–ø–∞—Ä–≥–∞–ª–∫–∞)

```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
ss -tn | grep :8080 | wc -l

# –ö—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω (—Ç–æ–ø 10)
ss -tn | grep :8080 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -rn | head -10

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–∫—Å–∏
systemctl status tinyproxy

# –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã
fail2ban-client status tinyproxy

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç)
check-proxy-status.sh
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑ –≤ –¥–µ–Ω—å** (–∏–ª–∏ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é, –µ—Å–ª–∏ –≤—Å–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ)
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç** `check-proxy-status.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
3. **–í–µ–¥–∏—Ç–µ –∂—É—Ä–Ω–∞–ª** - –∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ç—Ä–µ–Ω–¥—ã
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

**–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** 1-2 –º–∏–Ω—É—Ç—ã  
**–ß–∞—Å—Ç–æ—Ç–∞:** –†–∞–∑ –≤ –¥–µ–Ω—å (–∏–ª–∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
